1、power designer设计E-R图：
MIS/Cache_-44a3a1b447390be..jpg



2、SQL语句：
   保养：
    CREATE TABLE `equipmentcheck` (
   `checkid` int(11) NOT NULL AUTO_INCREMENT,
   `checkperiod` int(11) NOT NULL,
   `checkdate` date NOT NULL,
   `checker` varchar(45) NOT NULL,
   PRIMARY KEY (`checkid`)
 ) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8
   设备:
   CREATE TABLE `equip` (
   `eqid` int(11) NOT NULL,
   `eqkid` varchar(45) NOT NULL,
   `advancedtime` int(11) NOT NULL,
   PRIMARY KEY (`eqid`),
   KEY `equid_idx` (`eqkid`)
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8
   保养记录：
  CREATE TABLE `checkrecord` (
   `recordid` int(11) NOT NULL AUTO_INCREMENT,
   `checkid` int(11) NOT NULL,
   `eqid` int(11) NOT NULL,
   `item` varchar(45) NOT NULL,
   `description` varchar(45) DEFAULT NULL,
   PRIMARY KEY (`recordid`),
   KEY `checkid_idx` (`checkid`),
   KEY `eqid_idx` (`eqid`),
   CONSTRAINT `checkid` FOREIGN KEY (`checkid`) REFERENCES `equipmentcheck` (`checkid`) ON DELETE NO ACTION ON UPDATE NO ACTION,
   CONSTRAINT `eqid` FOREIGN KEY (`eqid`) REFERENCES `equip` (`eqid`) ON DELETE NO ACTION ON UPDATE NO ACTION
 ) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8
   检修项目：
    CREATE TABLE `content` (
   `eqkid` varchar(45) NOT NULL,
   `item` varchar(45) NOT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8
   
   材料消耗：
    CREATE TABLE `consumerecord` (
   `recordid` int(11) NOT NULL,
   `material` varchar(45) DEFAULT NULL,
   `num` int(11) DEFAULT NULL,
   KEY `recordid_idx` (`recordid`),
   CONSTRAINT `recordid` FOREIGN KEY (`recordid`) REFERENCES `checkrecord` (`recordid`) ON DELETE NO ACTION ON UPDATE NO ACTION
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8
   材料：
   CREATE TABLE `materialtable` (
   `materialid` int(11) NOT NULL AUTO_INCREMENT,
   `material` varchar(45) NOT NULL,
   `totalnum` int(11) NOT NULL,
   `rest` int(11) NOT NULL,
   PRIMARY KEY (`materialid`)
 ) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8
 
 模拟数据：
 
 3、根据设备编号查询：
 
use equipment;
SELECT eqid,checkrecord.checkid,checkperiod,checkdate,checker,checkrecord.recordid,
item,description,materialid,num 
FROM consumerecord ,checkrecord,equipmentcheck
where consumerecord.recordid=checkrecord.recordid
 and checkrecord.checkid=equipmentcheck.checkid  
 and checkrecord.eqid=1;
 
 4、预警：
  use equipment;
 select distinct   eqid from 
						(select max(checkdate) as maxd,equip.eqid,advancedtime 
						from equip ,equipmentcheck,checkrecord 
						where equip.eqid=checkrecord.eqid and checkrecord.checkid=equipmentcheck.checkid 
                        group by equip.eqid) as t 
 where datediff(current_date,maxd)<advancedtime;
 
